{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# WaveBank\n",
    "`WaveBank` is an in-process database for accessing seismic time-series data. Any directory structure containing obspy-readable waveforms can be used as the data source. `WaveBank` uses a simple indexing scheme and the [Hierarchical Data Format](https://en.wikipedia.org/wiki/Hierarchical_Data_Format) to keep track of each `Trace` in the directory.\n",
    "\n",
    "For example, after downloading seismic data with [obspy's fdsn mass download](https://docs.obspy.org/packages/autogen/obspy.clients.fdsn.mass_downloader.html), you need a way to access the data. You could manually read in each file but this can become very tedious and clutters up your application code with data access code. Enter WaveBank. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Create a WaveBank object\n",
    "We will use the [Crandall Canyon](https://en.wikipedia.org/wiki/Crandall_Canyon_Mine) dataset from [ObsPlus' datasets](../datasets/datasets.ipynb) to create a new `WaveBank` instance. This will ensure the waveforms have been downloaded (to the obsplus installation directory), copy the dataset to a temporary directory, and initialize a `WaveBank` instance."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "downloading waveform data for crandall_test dataset ...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[2020-06-01 23:19:41,864] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:19:41,866] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:19:41,867] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:19:41,867] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:19:43,120] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.25 seconds)\n",
      "[2020-06-01 23:19:43,177] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:19:43,182] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:19:43,186] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:19:44,450] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:19:47,671] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 41 channels (of 50)\n",
      "[2020-06-01 23:19:47,672] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:19:47,732] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.4 MB [98.56 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:19:47,733] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:19:47,734] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:19:47,926] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.O18A.xml'.\n",
      "[2020-06-01 23:19:47,929] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.O15A.xml'.\n",
      "[2020-06-01 23:19:47,942] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.P16A.xml'.\n",
      "[2020-06-01 23:19:48,053] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.P15A.xml'.\n",
      "[2020-06-01 23:19:48,058] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.O16A.xml'.\n",
      "[2020-06-01 23:19:48,117] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.P17A.xml'.\n",
      "[2020-06-01 23:19:48,693] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.P18A.xml'.\n",
      "[2020-06-01 23:19:48,695] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.R17A.xml'.\n",
      "[2020-06-01 23:19:48,695] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.Q16A.xml'.\n",
      "[2020-06-01 23:19:48,789] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.Q15A.xml'.\n",
      "[2020-06-01 23:19:48,820] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.Q18A.xml'.\n",
      "[2020-06-01 23:19:48,831] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/UU.CTU.xml'.\n",
      "[2020-06-01 23:19:48,937] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/UU.MPU.xml'.\n",
      "[2020-06-01 23:19:49,036] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/UU.SRU.xml'.\n",
      "[2020-06-01 23:19:49,060] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/UU.NLU.xml'.\n",
      "[2020-06-01 23:19:49,141] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/UU.TMU.xml'.\n",
      "[2020-06-01 23:19:49,161] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 16 station files [0.4 MB] in 1.4 seconds [303.39 KB/sec].\n",
      "[2020-06-01 23:19:49,162] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:19:49,163] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:19:49,163] - obspy.clients.fdsn.mass_downloader - INFO: 0 StationXML files [0.0 MB] already existed.\n",
      "[2020-06-01 23:19:49,165] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 48 MiniSEED files [0.4 MB].\n",
      "[2020-06-01 23:19:49,165] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 16 StationXML files [0.4 MB].\n",
      "[2020-06-01 23:19:49,166] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.8 MB in total.\n",
      "[2020-06-01 23:19:49,367] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:19:49,369] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:19:49,370] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:19:49,370] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:19:50,769] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.40 seconds)\n",
      "[2020-06-01 23:19:50,824] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:19:50,830] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:19:50,833] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:19:52,650] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:19:55,200] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 44 channels (of 50)\n",
      "[2020-06-01 23:19:55,201] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:19:55,262] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [68.83 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:19:55,262] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:19:55,263] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:19:55,472] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded '/home/runner/opsdata/crandall_test/stations/TA.R16A.xml'.\n",
      "[2020-06-01 23:19:55,475] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 1 station files [0.0 MB] in 0.2 seconds [122.06 KB/sec].\n",
      "[2020-06-01 23:19:55,476] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:19:55,476] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:19:55,477] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:19:55,478] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 51 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:19:55,479] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 1 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:19:55,479] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:19:55,674] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:19:55,676] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:19:55,677] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:19:55,677] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:19:56,597] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.92 seconds)\n",
      "[2020-06-01 23:19:56,652] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:19:56,658] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:19:56,661] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:19:57,783] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:19:59,128] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 44 channels (of 50)\n",
      "[2020-06-01 23:19:59,129] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:19:59,189] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [128.53 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:19:59,191] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:19:59,191] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:19:59,218] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:19:59,219] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:19:59,220] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:19:59,221] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:19:59,222] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 51 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:19:59,223] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:19:59,223] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:19:59,404] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:19:59,406] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:19:59,407] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:19:59,407] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:00,341] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.93 seconds)\n",
      "[2020-06-01 23:20:00,396] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:00,402] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:00,406] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:01,680] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:20:03,998] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 44 channels (of 50)\n",
      "[2020-06-01 23:20:03,999] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:04,059] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [89.09 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:04,060] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:04,061] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:20:04,087] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:04,088] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:04,088] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:20:04,089] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:04,090] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 51 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:20:04,091] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:04,092] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:20:04,279] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:04,280] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:04,281] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:04,282] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:05,187] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.90 seconds)\n",
      "[2020-06-01 23:20:05,243] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:05,249] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:05,253] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:06,451] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:20:08,599] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 44 channels (of 50)\n",
      "[2020-06-01 23:20:08,600] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:08,659] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [97.29 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:08,660] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:08,661] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:20:08,687] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:08,687] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:08,688] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:20:08,690] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:08,691] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 51 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:20:08,691] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:08,692] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:20:08,872] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:08,873] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:08,874] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:08,874] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:09,836] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.96 seconds)\n",
      "[2020-06-01 23:20:09,891] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:09,897] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:09,901] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:11,414] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:20:12,909] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 41 channels (of 50)\n",
      "[2020-06-01 23:20:12,910] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:12,965] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [95.07 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:12,966] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:12,966] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:20:12,989] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:12,989] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:12,990] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:20:12,991] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:12,992] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 48 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:20:12,992] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:12,993] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:20:13,199] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:13,201] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:13,201] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:13,202] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:14,474] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.27 seconds)\n",
      "[2020-06-01 23:20:14,532] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:14,538] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:14,541] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:15,076] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:20:17,227] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 44 channels (of 50)\n",
      "[2020-06-01 23:20:17,229] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:17,288] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [119.33 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:17,289] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:17,290] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:20:17,314] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:17,315] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:17,315] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:20:17,316] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:17,318] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 51 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:20:17,318] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:17,319] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n",
      "[2020-06-01 23:20:17,501] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:17,503] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:17,504] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:17,505] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:18,665] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.16 seconds)\n",
      "[2020-06-01 23:20:18,720] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:18,727] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:18,730] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 57 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:19,428] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 7 channels (of 7)\n",
      "[2020-06-01 23:20:20,454] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully downloaded 41 channels (of 50)\n",
      "[2020-06-01 23:20:20,456] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:20,512] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.3 MB [182.99 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:20,513] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:20,514] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: DOWNLOADED\n",
      "[2020-06-01 23:20:20,537] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:20,538] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:20,538] - obspy.clients.fdsn.mass_downloader - INFO: 0 MiniSEED files [0.0 MB] already existed.\n",
      "[2020-06-01 23:20:20,540] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:20,541] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 48 MiniSEED files [0.3 MB].\n",
      "[2020-06-01 23:20:20,541] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:20,542] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.3 MB in total.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "finished downloading waveform data for crandall_test\n",
      "downloading station data for crandall_test dataset ...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[2020-06-01 23:20:22,522] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:22,524] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:22,525] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:22,525] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:24,242] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.72 seconds)\n",
      "[2020-06-01 23:20:24,299] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:24,305] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:24,308] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:24,309] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:24,738] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:24,739] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:24,740] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:24,741] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:24,741] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:24,764] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:24,765] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:24,766] - obspy.clients.fdsn.mass_downloader - INFO: 48 MiniSEED files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:24,767] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:24,768] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:24,768] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:24,769] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:24,864] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:24,866] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:24,867] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:24,867] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:26,199] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.33 seconds)\n",
      "[2020-06-01 23:20:26,256] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:26,262] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:26,265] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:26,266] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:26,710] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:26,711] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:26,712] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:26,712] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:26,713] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:26,737] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:26,738] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:26,739] - obspy.clients.fdsn.mass_downloader - INFO: 51 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:26,740] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:26,740] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:26,741] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:26,741] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:26,840] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:26,842] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:26,842] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:26,843] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:28,008] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.16 seconds)\n",
      "[2020-06-01 23:20:28,066] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:28,072] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:28,075] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:28,075] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:28,467] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:28,468] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:28,469] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:28,469] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:28,470] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:28,496] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:28,497] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:28,498] - obspy.clients.fdsn.mass_downloader - INFO: 51 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:28,499] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:28,499] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:28,500] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:28,500] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:28,598] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:28,600] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:28,600] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:28,601] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:30,055] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.45 seconds)\n",
      "[2020-06-01 23:20:30,112] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:30,118] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:30,121] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:30,122] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:30,511] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:30,512] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:30,512] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:30,513] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:30,514] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:30,539] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:30,539] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:30,540] - obspy.clients.fdsn.mass_downloader - INFO: 51 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:30,541] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:30,542] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:30,543] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:30,543] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:30,635] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:30,637] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:30,637] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:30,638] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:31,804] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.17 seconds)\n",
      "[2020-06-01 23:20:31,859] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:31,865] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:31,867] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:31,868] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:32,258] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:32,260] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:32,260] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:32,261] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:32,262] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:32,288] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:32,289] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:32,290] - obspy.clients.fdsn.mass_downloader - INFO: 51 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:32,291] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:32,292] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:32,292] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:32,293] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:32,389] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:32,391] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:32,392] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:32,392] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:33,275] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.88 seconds)\n",
      "[2020-06-01 23:20:33,332] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:33,338] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:33,341] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:33,342] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:33,685] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:33,687] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:33,688] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:33,688] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:33,689] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:33,711] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:33,712] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:33,713] - obspy.clients.fdsn.mass_downloader - INFO: 48 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:33,714] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:33,715] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:33,715] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:33,716] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:33,815] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:33,817] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:33,818] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:33,818] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:34,804] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (0.99 seconds)\n",
      "[2020-06-01 23:20:34,861] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:34,867] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:34,870] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:34,871] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:35,292] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:35,293] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:35,294] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:35,295] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 6 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:35,295] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 51 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:35,321] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:35,322] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:35,323] - obspy.clients.fdsn.mass_downloader - INFO: 51 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:35,324] - obspy.clients.fdsn.mass_downloader - INFO: 17 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:35,325] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:35,325] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:35,326] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n",
      "[2020-06-01 23:20:35,419] - obspy.clients.fdsn.mass_downloader - INFO: Initializing FDSN client(s) for http://service.iris.edu.\n",
      "[2020-06-01 23:20:35,421] - obspy.clients.fdsn.mass_downloader - INFO: Successfully initialized 1 client(s): http://service.iris.edu.\n",
      "[2020-06-01 23:20:35,422] - obspy.clients.fdsn.mass_downloader - INFO: Total acquired or preexisting stations: 0\n",
      "[2020-06-01 23:20:35,422] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Requesting reliable availability.\n",
      "[2020-06-01 23:20:36,465] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Successfully requested availability (1.04 seconds)\n",
      "[2020-06-01 23:20:36,522] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Found 19 stations (57 channels).\n",
      "[2020-06-01 23:20:36,528] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Will attempt to download data from 19 stations.\n",
      "[2020-06-01 23:20:36,531] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels before downloading: EXISTS\n",
      "[2020-06-01 23:20:36,532] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels before downloading: NEEDS_DOWNLOADING\n",
      "[2020-06-01 23:20:37,207] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No data available for request.\n",
      "[2020-06-01 23:20:37,208] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Launching basic QC checks...\n",
      "[2020-06-01 23:20:37,209] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Downloaded 0.0 MB [0.00 KB/sec] of data, 0.0 MB of which were discarded afterwards.\n",
      "[2020-06-01 23:20:37,210] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 9 time intervals/channels after downloading: DOWNLOAD_FAILED\n",
      "[2020-06-01 23:20:37,210] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Status for 48 time intervals/channels after downloading: EXISTS\n",
      "[2020-06-01 23:20:37,234] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - No station information to download.\n",
      "[2020-06-01 23:20:37,235] - obspy.clients.fdsn.mass_downloader - INFO: ============================== Final report\n",
      "[2020-06-01 23:20:37,237] - obspy.clients.fdsn.mass_downloader - INFO: 48 MiniSEED files [0.3 MB] already existed.\n",
      "[2020-06-01 23:20:37,237] - obspy.clients.fdsn.mass_downloader - INFO: 16 StationXML files [0.4 MB] already existed.\n",
      "[2020-06-01 23:20:37,238] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 MiniSEED files [0.0 MB].\n",
      "[2020-06-01 23:20:37,238] - obspy.clients.fdsn.mass_downloader - INFO: Client 'http://service.iris.edu' - Acquired 0 StationXML files [0.0 MB].\n",
      "[2020-06-01 23:20:37,239] - obspy.clients.fdsn.mass_downloader - INFO: Downloaded 0.0 MB in total.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "finished downloading station data for crandall_test\n",
      "downloading event data for crandall_test dataset ...\n",
      "finished downloading event data for crandall_test\n",
      "/tmp/tmpusyijvwd/crandall_test/waveforms\n"
     ]
    }
   ],
   "source": [
    "import obsplus\n",
    "\n",
    "# get the crandall dataset bank\n",
    "crandall = obsplus.copy_dataset('crandall_test')\n",
    "# a directory of waveforms now lives here:\n",
    "waveform_path = crandall.waveform_path\n",
    "print(waveform_path)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we just need to feed the path of the waveform files to the WaveBank constructor."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "bank = obsplus.WaveBank(waveform_path)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "To ensure the index is up-to-date you can call the `udpate_index` method on the bank. This will iterate through all files that are timestamped later than the last time `update_index` was run.\n",
    "\n",
    "You only need to run `update_index` if the directory has not been indexed before or you have added new files to it. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "WaveBank(base_path=/tmp/tmpusyijvwd/crandall_test/waveforms)"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bank.update_index()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Get waveforms\n",
    "\n",
    "Now we can get files from the directory with the `get_waveforms` method, which has the same signature as the obspy client get_waveform methods:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "5 Trace(s) in Stream:\n",
      "TA.O15A..BHE | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n",
      "TA.O15A..BHN | 2007-08-06T01:44:47.999998Z - 2007-08-06T01:45:47.999998Z | 40.0 Hz, 2401 samples\n",
      "TA.O15A..BHZ | 2007-08-06T01:44:47.999998Z - 2007-08-06T01:45:47.999998Z | 40.0 Hz, 2401 samples\n",
      "TA.O16A..BHE | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n",
      "TA.O16A..BHN | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n"
     ]
    }
   ],
   "source": [
    "import obspy\n",
    "\n",
    "t1 = obspy.UTCDateTime('2007-08-06T01-44-48')\n",
    "t2 = t1 + 60\n",
    "st = bank.get_waveforms(starttime=t1, endtime=t2)\n",
    "print (st[:5])  # print first 5 traces"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We can, of course, filter on channels, locations, stations, networks, etc. using linux style search strings or regex. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "5 Trace(s) in Stream:\n",
      "UU.CTU..HHE | 2007-08-06T01:44:48.004000Z - 2007-08-06T01:45:48.004000Z | 100.0 Hz, 6001 samples\n",
      "UU.CTU..HHN | 2007-08-06T01:44:48.004000Z - 2007-08-06T01:45:48.004000Z | 100.0 Hz, 6001 samples\n",
      "UU.CTU..HHZ | 2007-08-06T01:44:48.004000Z - 2007-08-06T01:45:48.004000Z | 100.0 Hz, 6001 samples\n",
      "UU.MPU..HHE | 2007-08-06T01:44:48.002000Z - 2007-08-06T01:45:48.002000Z | 100.0 Hz, 6001 samples\n",
      "UU.MPU..HHN | 2007-08-06T01:44:48.002000Z - 2007-08-06T01:45:48.002000Z | 100.0 Hz, 6001 samples\n"
     ]
    }
   ],
   "source": [
    "st2 = bank.get_waveforms(network='UU', starttime=t1, endtime=t2)\n",
    "\n",
    "# ensure only UU traces were returned\n",
    "for tr in st2:\n",
    "    assert tr.stats.network == 'UU'\n",
    "\n",
    "print(st2[:5])  # print first 5 traces"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "6 Trace(s) in Stream:\n",
      "TA.O15A..BHE | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n",
      "TA.O15A..BHN | 2007-08-06T01:44:47.999998Z - 2007-08-06T01:45:47.999998Z | 40.0 Hz, 2401 samples\n",
      "TA.O16A..BHE | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n",
      "TA.O16A..BHN | 2007-08-06T01:44:48.000000Z - 2007-08-06T01:45:48.000000Z | 40.0 Hz, 2401 samples\n",
      "TA.O18A..BHE | 2007-08-06T01:44:47.999998Z - 2007-08-06T01:45:47.999998Z | 40.0 Hz, 2401 samples\n",
      "TA.O18A..BHN | 2007-08-06T01:44:47.999998Z - 2007-08-06T01:45:47.999998Z | 40.0 Hz, 2401 samples\n"
     ]
    }
   ],
   "source": [
    "st = bank.get_waveforms(starttime=t1, endtime=t2, station='O1??', channel='BH[NE]')\n",
    "\n",
    "# test returned traces\n",
    "for tr in st:\n",
    "    assert tr.stats.starttime >= t1 - .00001\n",
    "    assert tr.stats.endtime <= t2 + .00001\n",
    "    assert tr.stats.station.startswith('O1')\n",
    "    assert tr.stats.channel.startswith('BH')\n",
    "    assert tr.stats.channel[-1] in {'N', 'E'}\n",
    "\n",
    "print(st)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "WaveBank also shares the `get_waveforms_bulk` method with the FDSN client for efficiently retrieving a large number of streams. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "2 Trace(s) in Stream:\n",
      "TA.O15A..BHZ | 2007-08-06T01:44:42.999998Z - 2007-08-06T01:45:42.999998Z | 40.0 Hz, 2401 samples\n",
      "UU.SRU..HHZ  | 2007-08-06T01:44:47.995000Z - 2007-08-06T01:45:47.995000Z | 100.0 Hz, 6001 samples\n"
     ]
    }
   ],
   "source": [
    "args = [  # in practice this list may contain hundreds or thousands of requests\n",
    "    ('TA', 'O15A', '', 'BHZ', t1 - 5, t2 - 5,),\n",
    "    ('UU', 'SRU', '', 'HHZ', t1, t2,),\n",
    "]\n",
    "st = bank.get_waveforms_bulk(args)\n",
    "print(st )"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Yield waveforms\n",
    "The Bank class also provides a generator for iterating large amounts of continuous waveforms. For example, if you wanted to run a power detector on the data it might make sense to process one hour at a time with a minute of overlap between the slices. We first need to create a bank on a dataset which has continuous data. For this we will use the TA dataset."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "downloading waveform data for ta_test dataset ...\n",
      "finished downloading waveform data for ta_test\n",
      "downloading station data for ta_test dataset ...\n",
      "finished downloading station data for ta_test\n",
      "downloading event data for ta_test dataset ...\n",
      "finished downloading event data for ta_test\n"
     ]
    }
   ],
   "source": [
    "ds = obsplus.load_dataset('TA_test')\n",
    "ta_bank = obsplus.WaveBank(ds.waveform_client)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "got 6 streams from 2007-02-15T00:00:09.999998Z to 2007-02-15T01:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T00:59:59.999998Z to 2007-02-15T02:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T01:59:59.999998Z to 2007-02-15T03:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T02:59:59.999998Z to 2007-02-15T04:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T03:59:59.999998Z to 2007-02-15T05:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T04:59:59.999998Z to 2007-02-15T06:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T05:59:59.999998Z to 2007-02-15T07:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T06:59:59.999998Z to 2007-02-15T08:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T07:59:59.999998Z to 2007-02-15T09:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T08:59:59.999998Z to 2007-02-15T10:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T09:59:59.999998Z to 2007-02-15T11:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T10:59:59.999998Z to 2007-02-15T12:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T11:59:59.999998Z to 2007-02-15T13:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T12:59:59.999998Z to 2007-02-15T14:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T13:59:59.999998Z to 2007-02-15T15:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T14:59:59.999998Z to 2007-02-15T16:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T15:59:59.999998Z to 2007-02-15T17:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T16:59:59.999998Z to 2007-02-15T18:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T17:59:59.999998Z to 2007-02-15T19:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T18:59:59.999998Z to 2007-02-15T20:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T19:59:59.999998Z to 2007-02-15T21:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T20:59:59.999998Z to 2007-02-15T22:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T21:59:59.999998Z to 2007-02-15T23:00:59.999998Z\n",
      "got 6 streams from 2007-02-15T22:59:59.999998Z to 2007-02-16T00:00:59.999998Z\n"
     ]
    }
   ],
   "source": [
    "# get a few hours of kemmerer data\n",
    "ta_t1 = obspy.UTCDateTime('2007-02-15')\n",
    "ta_t2 = obspy.UTCDateTime('2007-02-16')\n",
    "\n",
    "for st in ta_bank.yield_waveforms(starttime=ta_t1, endtime=ta_t2, duration=3600, overlap=60):\n",
    "    print (f'got {len(st)} streams from {st[0].stats.starttime} to {st[0].stats.endtime}')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Put waveforms\n",
    "You can also add files to the bank by passing a stream or trace to the `bank.put_waveforms` method. WaveBank, however, does not do any file merging so you might end up with overlaps in data if you are not careful."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "0 Trace(s) in Stream:\n",
      "\n"
     ]
    }
   ],
   "source": [
    "# show that no data for RJOB is in the bank\n",
    "st = bank.get_waveforms(station='RJOB')\n",
    "\n",
    "assert len(st) == 0\n",
    "\n",
    "print(st)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "3 Trace(s) in Stream:\n",
      "BW.RJOB..EHE | 2009-08-24T00:20:03.000000Z - 2009-08-24T00:20:32.990000Z | 100.0 Hz, 3000 samples\n",
      "BW.RJOB..EHN | 2009-08-24T00:20:03.000000Z - 2009-08-24T00:20:32.990000Z | 100.0 Hz, 3000 samples\n",
      "BW.RJOB..EHZ | 2009-08-24T00:20:03.000000Z - 2009-08-24T00:20:32.990000Z | 100.0 Hz, 3000 samples\n"
     ]
    }
   ],
   "source": [
    "# add the default stream to the archive (which contains data for RJOB)\n",
    "bank.put_waveforms(obspy.read())\n",
    "st_out = bank.get_waveforms(station='RJOB')\n",
    "\n",
    "# test output\n",
    "assert len(st_out)\n",
    "for tr in st_out:\n",
    "    assert tr.stats.station == 'RJOB'\n",
    "\n",
    "\n",
    "print(st_out)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Availability\n",
    "You can also use WaveBank to get availability of data, either as a dataframe or as a list of tuples in the form of [(network, station, location, channel, min_starttime, max_endtime)], which is the same as output by the `availability` method of [Obspy's Earthworm client](https://docs.obspy.org/master/packages/obspy.clients.earthworm.html)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>network</th>\n",
       "      <th>station</th>\n",
       "      <th>location</th>\n",
       "      <th>channel</th>\n",
       "      <th>starttime</th>\n",
       "      <th>endtime</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 01:44:38.825000</td>\n",
       "      <td>2007-08-07 21:43:51.124998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>TA</td>\n",
       "      <td>O16A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 01:44:38.825000</td>\n",
       "      <td>2007-08-07 21:43:51.125000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>TA</td>\n",
       "      <td>O18A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 01:44:38.824998</td>\n",
       "      <td>2007-08-07 21:43:51.125000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TA</td>\n",
       "      <td>R16A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-07 02:04:54.500000</td>\n",
       "      <td>2007-08-07 21:43:51.125000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TA</td>\n",
       "      <td>R17A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 01:44:38.825000</td>\n",
       "      <td>2007-08-07 21:43:51.125000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  network station location channel                  starttime  \\\n",
       "0      TA    O15A              BHE 2007-08-06 01:44:38.825000   \n",
       "1      TA    O16A              BHE 2007-08-06 01:44:38.825000   \n",
       "2      TA    O18A              BHE 2007-08-06 01:44:38.824998   \n",
       "3      TA    R16A              BHE 2007-08-07 02:04:54.500000   \n",
       "4      TA    R17A              BHE 2007-08-06 01:44:38.825000   \n",
       "\n",
       "                     endtime  \n",
       "0 2007-08-07 21:43:51.124998  \n",
       "1 2007-08-07 21:43:51.125000  \n",
       "2 2007-08-07 21:43:51.125000  \n",
       "3 2007-08-07 21:43:51.125000  \n",
       "4 2007-08-07 21:43:51.125000  "
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# get a dataframe of availability by seed ids and timestamps\n",
    "bank.get_availability_df(channel='BHE', station='[OR]*')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[('TA',\n",
       "  'O15A',\n",
       "  '',\n",
       "  'BHE',\n",
       "  2007-08-06T01:44:38.825000Z,\n",
       "  2007-08-07T21:43:51.124998Z),\n",
       " ('TA',\n",
       "  'O16A',\n",
       "  '',\n",
       "  'BHE',\n",
       "  2007-08-06T01:44:38.825000Z,\n",
       "  2007-08-07T21:43:51.125000Z),\n",
       " ('TA',\n",
       "  'O18A',\n",
       "  '',\n",
       "  'BHE',\n",
       "  2007-08-06T01:44:38.824998Z,\n",
       "  2007-08-07T21:43:51.125000Z),\n",
       " ('TA',\n",
       "  'R16A',\n",
       "  '',\n",
       "  'BHE',\n",
       "  2007-08-07T02:04:54.500000Z,\n",
       "  2007-08-07T21:43:51.125000Z),\n",
       " ('TA',\n",
       "  'R17A',\n",
       "  '',\n",
       "  'BHE',\n",
       "  2007-08-06T01:44:38.825000Z,\n",
       "  2007-08-07T21:43:51.125000Z)]"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bank.availability(channel='BHE', station='[OR]*')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Get Gaps and uptime\n",
    "WaveBank can also return a dataframe of missing data with the `get_gaps_df` method, as well as return a dataframe of reliability statistics. These are useful, for example, if you are trying to assess the completeness of an archive of contiguous data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>network</th>\n",
       "      <th>station</th>\n",
       "      <th>location</th>\n",
       "      <th>channel</th>\n",
       "      <th>starttime</th>\n",
       "      <th>endtime</th>\n",
       "      <th>sampling_period</th>\n",
       "      <th>path</th>\n",
       "      <th>gap_duration</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 01:45:48.799998</td>\n",
       "      <td>2007-08-06 08:48:30.024998</td>\n",
       "      <td>00:00:00.025000</td>\n",
       "      <td>/TA.O15A..BHE__20070806T014438Z__20070806T0145...</td>\n",
       "      <td>07:02:41.225000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 08:49:39.999998</td>\n",
       "      <td>2007-08-06 10:47:15.624998</td>\n",
       "      <td>00:00:00.025000</td>\n",
       "      <td>/TA.O15A..BHE__20070806T084830Z__20070806T0849...</td>\n",
       "      <td>01:57:35.625000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-06 10:48:25.599998</td>\n",
       "      <td>2007-08-07 02:04:54.499998</td>\n",
       "      <td>00:00:00.025000</td>\n",
       "      <td>/TA.O15A..BHE__20070806T104715Z__20070806T1048...</td>\n",
       "      <td>15:16:28.900000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-07 02:06:04.474998</td>\n",
       "      <td>2007-08-07 02:14:14.100000</td>\n",
       "      <td>00:00:00.025000</td>\n",
       "      <td>/TA.O15A..BHE__20070807T020454Z__20070807T0206...</td>\n",
       "      <td>00:08:09.625002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TA</td>\n",
       "      <td>O15A</td>\n",
       "      <td></td>\n",
       "      <td>BHE</td>\n",
       "      <td>2007-08-07 02:15:24.074998</td>\n",
       "      <td>2007-08-07 03:44:08.474998</td>\n",
       "      <td>00:00:00.025000</td>\n",
       "      <td>/TA.O15A..BHE__20070807T021414Z__20070807T0215...</td>\n",
       "      <td>01:28:44.400000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  network station location channel                  starttime  \\\n",
       "0      TA    O15A              BHE 2007-08-06 01:45:48.799998   \n",
       "1      TA    O15A              BHE 2007-08-06 08:49:39.999998   \n",
       "2      TA    O15A              BHE 2007-08-06 10:48:25.599998   \n",
       "3      TA    O15A              BHE 2007-08-07 02:06:04.474998   \n",
       "4      TA    O15A              BHE 2007-08-07 02:15:24.074998   \n",
       "\n",
       "                     endtime sampling_period  \\\n",
       "0 2007-08-06 08:48:30.024998 00:00:00.025000   \n",
       "1 2007-08-06 10:47:15.624998 00:00:00.025000   \n",
       "2 2007-08-07 02:04:54.499998 00:00:00.025000   \n",
       "3 2007-08-07 02:14:14.100000 00:00:00.025000   \n",
       "4 2007-08-07 03:44:08.474998 00:00:00.025000   \n",
       "\n",
       "                                                path    gap_duration  \n",
       "0  /TA.O15A..BHE__20070806T014438Z__20070806T0145... 07:02:41.225000  \n",
       "1  /TA.O15A..BHE__20070806T084830Z__20070806T0849... 01:57:35.625000  \n",
       "2  /TA.O15A..BHE__20070806T104715Z__20070806T1048... 15:16:28.900000  \n",
       "3  /TA.O15A..BHE__20070807T020454Z__20070807T0206... 00:08:09.625002  \n",
       "4  /TA.O15A..BHE__20070807T021414Z__20070807T0215... 01:28:44.400000  "
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bank.get_gaps_df(channel='BHE', station='O*').head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>network</th>\n",
       "      <th>station</th>\n",
       "      <th>location</th>\n",
       "      <th>channel</th>\n",
       "      <th>starttime</th>\n",
       "      <th>endtime</th>\n",
       "      <th>duration</th>\n",
       "      <th>gap_duration</th>\n",
       "      <th>uptime</th>\n",
       "      <th>availability</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHE</td>\n",
       "      <td>2007-02-15 00:00:09.999998</td>\n",
       "      <td>2007-02-24 23:59:59.999998</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>0 days</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHN</td>\n",
       "      <td>2007-02-15 00:00:09.999998</td>\n",
       "      <td>2007-02-24 23:59:59.999998</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>0 days</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-15 00:00:09.999998</td>\n",
       "      <td>2007-02-24 23:59:59.999998</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>0 days</td>\n",
       "      <td>9 days 23:59:50</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TA</td>\n",
       "      <td>M14A</td>\n",
       "      <td></td>\n",
       "      <td>VHE</td>\n",
       "      <td>2007-02-15 00:00:00.000003</td>\n",
       "      <td>2007-02-25 00:00:00.000003</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>0 days</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TA</td>\n",
       "      <td>M14A</td>\n",
       "      <td></td>\n",
       "      <td>VHN</td>\n",
       "      <td>2007-02-15 00:00:00.000003</td>\n",
       "      <td>2007-02-25 00:00:00.000003</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>0 days</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>TA</td>\n",
       "      <td>M14A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-15 00:00:00.000004</td>\n",
       "      <td>2007-02-25 00:00:00.000004</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>0 days</td>\n",
       "      <td>10 days 00:00:00</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  network station location channel                  starttime  \\\n",
       "0      TA    M11A              VHE 2007-02-15 00:00:09.999998   \n",
       "1      TA    M11A              VHN 2007-02-15 00:00:09.999998   \n",
       "2      TA    M11A              VHZ 2007-02-15 00:00:09.999998   \n",
       "3      TA    M14A              VHE 2007-02-15 00:00:00.000003   \n",
       "4      TA    M14A              VHN 2007-02-15 00:00:00.000003   \n",
       "5      TA    M14A              VHZ 2007-02-15 00:00:00.000004   \n",
       "\n",
       "                     endtime         duration gap_duration           uptime  \\\n",
       "0 2007-02-24 23:59:59.999998  9 days 23:59:50       0 days  9 days 23:59:50   \n",
       "1 2007-02-24 23:59:59.999998  9 days 23:59:50       0 days  9 days 23:59:50   \n",
       "2 2007-02-24 23:59:59.999998  9 days 23:59:50       0 days  9 days 23:59:50   \n",
       "3 2007-02-25 00:00:00.000003 10 days 00:00:00       0 days 10 days 00:00:00   \n",
       "4 2007-02-25 00:00:00.000003 10 days 00:00:00       0 days 10 days 00:00:00   \n",
       "5 2007-02-25 00:00:00.000004 10 days 00:00:00       0 days 10 days 00:00:00   \n",
       "\n",
       "   availability  \n",
       "0           1.0  \n",
       "1           1.0  \n",
       "2           1.0  \n",
       "3           1.0  \n",
       "4           1.0  \n",
       "5           1.0  "
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ta_bank.get_uptime_df()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Read index\n",
    "You can also read the index directly, although in most cases this shouldn't be needed."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>network</th>\n",
       "      <th>station</th>\n",
       "      <th>location</th>\n",
       "      <th>channel</th>\n",
       "      <th>starttime</th>\n",
       "      <th>endtime</th>\n",
       "      <th>sampling_period</th>\n",
       "      <th>path</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-17 11:59:59.999998</td>\n",
       "      <td>2007-02-17 12:59:59.999998</td>\n",
       "      <td>00:00:10</td>\n",
       "      <td>/TA/M11A/VHZ/2007-02-17T12-00-00.mseed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>TA</td>\n",
       "      <td>M14A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-17 12:00:00.000004</td>\n",
       "      <td>2007-02-17 13:00:00.000004</td>\n",
       "      <td>00:00:10</td>\n",
       "      <td>/TA/M11A/VHZ/2007-02-17T12-00-00.mseed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-24 14:59:59.999998</td>\n",
       "      <td>2007-02-24 15:59:59.999998</td>\n",
       "      <td>00:00:10</td>\n",
       "      <td>/TA/M11A/VHZ/2007-02-24T15-00-00.mseed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TA</td>\n",
       "      <td>M14A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-24 15:00:00.000004</td>\n",
       "      <td>2007-02-24 16:00:00.000004</td>\n",
       "      <td>00:00:10</td>\n",
       "      <td>/TA/M11A/VHZ/2007-02-24T15-00-00.mseed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TA</td>\n",
       "      <td>M11A</td>\n",
       "      <td></td>\n",
       "      <td>VHZ</td>\n",
       "      <td>2007-02-15 16:59:59.999998</td>\n",
       "      <td>2007-02-15 17:59:59.999998</td>\n",
       "      <td>00:00:10</td>\n",
       "      <td>/TA/M11A/VHZ/2007-02-15T17-00-00.mseed</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  network station location channel                  starttime  \\\n",
       "0      TA    M11A              VHZ 2007-02-17 11:59:59.999998   \n",
       "1      TA    M14A              VHZ 2007-02-17 12:00:00.000004   \n",
       "2      TA    M11A              VHZ 2007-02-24 14:59:59.999998   \n",
       "3      TA    M14A              VHZ 2007-02-24 15:00:00.000004   \n",
       "4      TA    M11A              VHZ 2007-02-15 16:59:59.999998   \n",
       "\n",
       "                     endtime sampling_period  \\\n",
       "0 2007-02-17 12:59:59.999998        00:00:10   \n",
       "1 2007-02-17 13:00:00.000004        00:00:10   \n",
       "2 2007-02-24 15:59:59.999998        00:00:10   \n",
       "3 2007-02-24 16:00:00.000004        00:00:10   \n",
       "4 2007-02-15 17:59:59.999998        00:00:10   \n",
       "\n",
       "                                     path  \n",
       "0  /TA/M11A/VHZ/2007-02-17T12-00-00.mseed  \n",
       "1  /TA/M11A/VHZ/2007-02-17T12-00-00.mseed  \n",
       "2  /TA/M11A/VHZ/2007-02-24T15-00-00.mseed  \n",
       "3  /TA/M11A/VHZ/2007-02-24T15-00-00.mseed  \n",
       "4  /TA/M11A/VHZ/2007-02-15T17-00-00.mseed  "
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ta_bank.read_index().head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Similar Projects\n",
    "`WaveBank` is a useful tool, but it may not be a good fit for every application. Check out the following items as well:\n",
    "\n",
    "Obspy has a way to visualize availability of waveform data in a directory using [obspy-scan](https://docs.obspy.org/tutorial/code_snippets/visualize_data_availability_of_local_waveform_archive.html). If you prefer a graphical option to working with `DataFrame`s this might be for you.\n",
    "\n",
    "Obspy also has [filesystem client](https://docs.obspy.org/master/packages/autogen/obspy.clients.filesystem.sds.Client.html#obspy.clients.filesystem.sds.Client) for working with SeisComP structured archives.\n",
    "\n",
    "[IRIS](https://www.iris.edu/hq/) released a mini-seed indexing program called [mseedindex](https://github.com/iris-edu/mseedindex) which will have an [ObsPy API](https://github.com/obspy/obspy/pull/2206). We personally have not yet used mseedindex but it certainly looks worth checking out."
   ]
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
