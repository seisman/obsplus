

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Working with Catalogs &#8212; ObsPlus  [ v0.1.1+11.g8ad3eab.dirty ] v0.1.1+11.g8ad3eab.dirty documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ObsPlus  [ v0.1.1+11.g8ad3eab.dirty ]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with Catalogs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Working-with-Catalogs">
<h1>Working with Catalogs<a class="headerlink" href="#Working-with-Catalogs" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.obspy.org/packages/obspy.core.html#event-metadata">Obspy’s event representation</a> is based on the <a class="reference external" href="http://www.fdsn.org/">FDSN</a> <a class="reference external" href="https://quake.ethz.ch/quakeml/">QuakeML standard</a>, which is very comprehensive, and arguably the best standard available. However, It can be a bit difficult to work with the <code class="docutils literal notranslate"><span class="pre">Catalog</span></code> object (and friends) for a few reasons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">Often</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">deeply</span> <span class="n">nested</span> <span class="ow">and</span> <span class="n">hard</span> <span class="n">to</span> <span class="n">aggregate</span>

<span class="mf">2.</span> <span class="n">Identifying</span> <span class="n">data</span> <span class="n">relations</span> <span class="n">depends</span> <span class="n">on</span> <span class="n">the</span> <span class="nb">complex</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">Obspy</span><span class="s1">&#39;s `ResourceIdentifier`</span>

<span class="mf">3.</span> <span class="n">Preferred</span> <span class="n">objects</span> <span class="p">(</span><span class="n">eg</span> <span class="n">origin</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span> <span class="n">are</span> <span class="n">often</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
</div>
<p>ObsPlus tries to solve all of these problems. The first is addressed by the <a class="reference internal" href="dataframeextractor.html"><span class="doc">DataFrame Extractor</span></a> and other tree transversal tools. The second and third are addressed by a collection of catalog validators</p>
<div class="section" id="Catalog-Navigation">
<h2>Catalog Navigation<a class="headerlink" href="#Catalog-Navigation" title="Permalink to this headline">¶</a></h2>
<p>If you only need to extract information contained in a catalog there are various examples of creating dataframes from different parts of the catalog in the <a class="reference internal" href="../datastructures/events_to_pandas.html"><span class="doc">events_to_pandas section</span></a>.</p>
<p>If, however, you need to maintain the tree structure the <code class="docutils literal notranslate"><span class="pre">yield_object_parent_attr</span></code> function can be very useful. For example, let’s assume we want to sabotage a seismic analyst by adding noise to his/her pick times. We could do that like so:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">obspy</span>
<span class="kn">import</span> <span class="nn">obspy.core.event</span> <span class="k">as</span> <span class="nn">ev</span>
<span class="kn">import</span> <span class="nn">obsplus</span>
<span class="kn">from</span> <span class="nn">obsplus.utils</span> <span class="kn">import</span> <span class="n">yield_obj_parent_attr</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">obsplus</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;crandall_test&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">event_client</span><span class="o">.</span><span class="n">get_events</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># iterate picks, add noise to pick time (-1 to 1 seconds, uniform dist.)</span>
<span class="k">for</span> <span class="n">pick</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">yield_obj_parent_attr</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">ev</span><span class="o">.</span><span class="n">Pick</span><span class="p">):</span>
    <span class="n">pick</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pick</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span>
</pre></div>
</div>
</div>
<p>Or, a less malicious example, perhaps we want to count all the <code class="docutils literal notranslate"><span class="pre">ResourceIdentifier</span></code> instances and ensure they have some minimum length. If they don’t we want to regenerate them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">replaced</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">rid</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">yield_obj_parent_attr</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">ev</span><span class="o">.</span><span class="n">ResourceIdentifier</span><span class="p">):</span>
    <span class="c1"># increment counter</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># if the resource id is longer than twenty keep going</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rid</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="c1"># else create a new resource_id and bind it to the parent</span>
    <span class="n">new_rid</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">ResourceIdentifier</span><span class="p">(</span><span class="n">referred_object</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">new_rid</span><span class="p">)</span>
    <span class="n">replaced</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> resource ids in the catalog. </span><span class="si">{</span><span class="n">replaced</span><span class="si">}</span><span class="s2"> were replaced.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 2807 resource ids in the catalog. 1407 were replaced.
</pre></div></div>
</div>
</div>
<div class="section" id="Catalog-Validation">
<h2>Catalog Validation<a class="headerlink" href="#Catalog-Validation" title="Permalink to this headline">¶</a></h2>
<p>In addition to being difficult to navigate (point 1), validating and ensuring catalogs work as expected (points 2-3) is non-trivial. ObsPlus’s <code class="docutils literal notranslate"><span class="pre">validate_catalog</span></code> helps by ensuring all resource_ids point to the correct objects, preferred objects are set, and preforming other sanity checks. The default event validation function in ObsPlus is a bit opinionated and was built specifically for the NIOSH style of QuakeML, but you may still find it useful. Additionally, you can create your own
validation namespace and define validators for your own data/schema as described by the <a class="reference internal" href="validators.html"><span class="doc">validators documentation</span></a>.</p>
</div>
<div class="section" id="Catalog-setup">
<h2>Catalog setup<a class="headerlink" href="#Catalog-setup" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a catalog that has the following problems:</p>
<ul class="simple">
<li><p>resource_id on arrivals no longer point to the correct picks (only possible to break on Obspy versions &lt;= 1.1.0)</p></li>
<li><p>no preferred origin/magnitudes are set</p></li>
</ul>
<p>ObsPlus will go through and set the resource_ids to point to the correct objects, and set all the preferred_{whatever} to the last element in the {whatever}s list (for whatever in [‘magnitude’, ‘origin’, ‘focal_mechanism’]).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># create catalog 1</span>
<span class="k">def</span> <span class="nf">create_cat1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; a catalog with an arrival that doesn&#39;t refer to any pick &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="s1">&#39;2017-09-22T08:35:00&#39;</span><span class="p">)</span>
    <span class="n">wid</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">WaveformStreamID</span><span class="p">(</span><span class="n">network_code</span><span class="o">=</span><span class="s1">&#39;UU&#39;</span><span class="p">,</span> <span class="n">station_code</span><span class="o">=</span><span class="s1">&#39;TMU&#39;</span><span class="p">,</span>
                              <span class="n">location_code</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">channel_code</span><span class="o">=</span><span class="s1">&#39;HHZ&#39;</span><span class="p">)</span>
    <span class="n">pick</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">phase_hint</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">waveform_id</span><span class="o">=</span><span class="n">wid</span><span class="p">)</span>
    <span class="n">arrival</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">Arrival</span><span class="p">(</span><span class="n">pick_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">,</span> <span class="n">waveform_id</span><span class="o">=</span><span class="n">wid</span><span class="p">)</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">Origin</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">arrivals</span><span class="o">=</span><span class="p">[</span><span class="n">arrival</span><span class="p">],</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">45.5</span><span class="p">,</span>
                       <span class="n">longitude</span><span class="o">=-</span><span class="mf">111.1</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">EventDescription</span><span class="p">(</span><span class="n">create_cat1</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="n">origins</span><span class="o">=</span><span class="p">[</span><span class="n">origin</span><span class="p">],</span> <span class="n">picks</span><span class="o">=</span><span class="p">[</span><span class="n">pick</span><span class="p">],</span>
                     <span class="n">event_descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">description</span><span class="p">])</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="n">event</span><span class="p">])</span>
    <span class="c1"># create a copy of the catalog. In older versions this would screw up</span>
    <span class="c1"># the resource ids, but the issue seems to be fixed now.</span>
    <span class="n">cat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cat</span>


<span class="n">cat</span> <span class="o">=</span> <span class="n">create_cat1</span><span class="p">()</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arrival</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pick</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">picks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Validate">
<h2>Validate<a class="headerlink" href="#Validate" title="Permalink to this headline">¶</a></h2>
<p>We can fix these two problems in place with the validate_catalog function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">obsplus</span><span class="o">.</span><span class="n">validate_catalog</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 Event(s) in Catalog:
2017-09-22T08:35:00.000000Z | +45.500, -111.100
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">preferred_origin</span><span class="p">())</span>
<span class="n">arrival</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># now we will get the correct pick through the arrival object, even on older versions of obspy</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arrival</span><span class="o">.</span><span class="n">pick_id</span><span class="o">.</span><span class="n">get_referred_object</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Origin
         resource_id: ResourceIdentifier(id=&#34;smi:local/6f9b7f9f-eedd-4289-8072-f3d8a0c1b4c4&#34;)
                time: UTCDateTime(2017, 9, 22, 8, 35)
           longitude: -111.1
            latitude: 45.5
                ---------
            arrivals: 1 Elements
Pick
         resource_id: ResourceIdentifier(id=&#34;smi:local/df562c29-cfb8-4008-aaa9-7f2f6fc68007&#34;)
                time: UTCDateTime(2017, 9, 22, 8, 35)
         waveform_id: WaveformStreamID(network_code=&#39;UU&#39;, station_code=&#39;TMU&#39;, channel_code=&#39;HHZ&#39;, location_code=&#39;&#39;)
          phase_hint: &#39;P&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Fail-fast">
<h2>Fail fast<a class="headerlink" href="#Fail-fast" title="Permalink to this headline">¶</a></h2>
<p>For issues that obsplus doesn’t know how to fix, an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> will be raised. If you are generating or downloading catalogs it may be useful to run them through the validation function right away so that you know there is an issue before trying to perform any meaningful analysis.</p>
<p>For example, if we had an arrival that didn’t refer to any known pick this could be a quality issue that you might like to know about.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a problem with the catalog</span>
<span class="n">old_pick_id</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pick_id</span>
<span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pick_id</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">obsplus</span><span class="o">.</span><span class="n">validate_catalog</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;something is wrong with this catalog&#39;</span><span class="p">)</span>

<span class="c1"># undo the problem</span>
<span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pick_id</span> <span class="o">=</span> <span class="n">old_pick_id</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
something is wrong with this catalog
</pre></div></div>
</div>
</div>
<div class="section" id="Adding-custom-validators">
<h2>Adding custom validators<a class="headerlink" href="#Adding-custom-validators" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="validators.html"><span class="doc">validators section</span></a> to learn how to create your own validators. If you simply want to use a subset of ObsPlus’ validators that can be done like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># import the validators that are desired</span>
<span class="kn">import</span> <span class="nn">obspy.core.event</span> <span class="k">as</span> <span class="nn">ev</span>
<span class="kn">from</span> <span class="nn">obsplus.utils.validate</span> <span class="kn">import</span> <span class="n">validator</span><span class="p">,</span> <span class="n">validate</span>
<span class="kn">from</span> <span class="nn">obsplus.events.validate</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">attach_all_resource_ids</span><span class="p">,</span>
    <span class="n">check_arrivals_pick_id</span><span class="p">,</span>
    <span class="n">check_duplicate_picks</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># create new validator namespace</span>
<span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;_new_test&#39;</span>
<span class="n">validator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">Event</span><span class="p">)(</span><span class="n">attach_all_resource_ids</span><span class="p">)</span>
<span class="n">validator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">Event</span><span class="p">)(</span><span class="n">check_arrivals_pick_id</span><span class="p">)</span>
<span class="n">validator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">Event</span><span class="p">)(</span><span class="n">check_duplicate_picks</span><span class="p">)</span>

<span class="c1"># run the new validator</span>
<span class="n">validate</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/obsplus_panda.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working with Catalogs</a><ul>
<li><a class="reference internal" href="#Catalog-Navigation">Catalog Navigation</a></li>
<li><a class="reference internal" href="#Catalog-Validation">Catalog Validation</a></li>
<li><a class="reference internal" href="#Catalog-setup">Catalog setup</a></li>
<li><a class="reference internal" href="#Validate">Validate</a></li>
<li><a class="reference internal" href="#Fail-fast">Fail fast</a></li>
<li><a class="reference internal" href="#Adding-custom-validators">Adding custom validators</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/notebooks/utils/working_with_catalogs.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ObsPlus  [ v0.1.1+11.g8ad3eab.dirty ]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with Catalogs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Derrick Chambers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>